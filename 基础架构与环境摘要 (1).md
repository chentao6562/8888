# 基础架构与环境摘要

**文档目的**: 为下一个大模型提供清晰、完整的环境上下文，以便快速接手并继续提供服务。

**最后更新时间**: 2026年1月4日

---

## 1. 阿里云 ECS 服务器

| 属性 | 值 |
|---|---|
| **实例 ID** | `launch-advisor-20260103` |
| **公网 IP** | `39.104.58.26` |
| **内网 IP** | `172.17.39.175` |
| **操作系统** | Alibaba Cloud Linux 3.2104 LTS 64位 |
| **CPU / 内存** | 4 vCPU / 8 GiB |
| **登录用户** | `root` |
| **登录密码** | `c65623518+` |

### 1.1. 已安装的关键软件

| 软件 | 版本 |
|---|---|
| **Git** | 2.43.7 |
| **Node.js** | v18.20.8 |
| **npm** | 10.8.2 |
| **PM2** | 最新版 (全局安装) |
| **MySQL Client** | 已安装 |
| **Nginx** | 1.20.1 |

### 1.2. 安全组配置 (`sg-hp3ed1dx5unjkxe1lzu`)

**入方向规则**:

| 端口 | 授权对象 | 描述 |
|---|---|---|
| **22/TCP** | 0.0.0.0/0 | SSH 远程连接 |
| **80/TCP** | 0.0.0.0/0 | HTTP 流量（API） |
| **443/TCP** | 0.0.0.0/0 | HTTPS 流量 |
| **3000/TCP** | 0.0.0.0/0 | 后端服务端口 |
| **3306/TCP** | 0.0.0.0/0 | MySQL 访问 |
| **9000/TCP** | 0.0.0.0/0 | GitHub Webhook 监听端口 |
| **9090/TCP** | 0.0.0.0/0 | 管理后台端口 |

**出方向规则**:
- 默认允许所有出站流量。

---

## 2. 阿里云 RDS 数据库

| 属性 | 值 |
|---|---|
| **实例 ID** | `rm-hp39t0j1y3xo2a25g` |
| **数据库类型** | MySQL 8.0 |
| **内网地址** | `rm-hp39t0j1y3xo2a25g.mysql.huhehaote.rds.aliyuncs.com` |
| **端口** | `3306` |
| **数据库名称** | `firework_db` |
| **登录用户** | `yanhuaxitong` |
| **登录密码** | `c65623518+` |
| **连接状态** | ✅ **正常** |

---

## 3. GitHub 仓库与项目

| 属性 | 值 |
|---|---|
| **仓库地址** | `https://github.com/chentao6562/test111` |
| **项目描述** | 烟花爆竹分销系统 |
| **默认分支** | `main` |
| **项目语言** | TypeScript 100% |
| **服务器部署目录** | `/root/projects/test111` |

---

## 4. 自动部署系统配置

### 4.1. 核心组件

- **触发方式**: GitHub Webhook
- **部署逻辑**: `git pull → npm install → prisma generate → build → PM2 restart`
- **运行环境**: Node.js + Express + Prisma
- **进程管理**: PM2

### 4.2. Webhook 服务

| 属性 | 值 |
|---|---|
| **服务脚本** | `/root/webhook/server.js` |
| **监听端口** | `9000` |
| **Payload URL** | `http://39.104.58.26:9000/webhook` |
| **Secret** | `firework2026` |
| **日志文件** | `/root/webhook/webhook.log` |
| **PM2 进程名** | `webhook-listener` |
| **运行状态** | ✅ **在线** |

### 4.3. SSH 认证 (用于 Git)

| 属性 | 值 |
|---|---|
| **认证方式** | Deploy Key (SSH 密钥) |
| **密钥类型** | ED25519 |
| **私钥路径** | `/root/.ssh/id_ed25519_github` |
| **公钥路径** | `/root/.ssh/id_ed25519_github.pub` |
| **SSH 配置文件** | `/root/.ssh/config` |
| **连接状态** | ✅ **正常** |

---

## 5. uniCloud 配置（小程序认证）

| 属性 | 值 |
|---|---|
| **服务商** | 阿里云 |
| **SpaceId** | `mp-ffc0e6ea-b59a-46d1-a78b-d3f2b0e1dc36` |
| **ClientSecret** | `1RSXBgRzPq8R6bkG90WDnA==` |
| **tokenSecret** | `firework-token-secret-2026` |
| **Request域名** | `https://api.next.bspapp.com` |

**认证方式**: 后端支持双Token验证
- JWT Token（管理后台、货管等）
- uni-id Token（小程序端）

---

## 6. PM2 进程列表

| 进程名 | 说明 | 状态 |
|---|---|---|
| **firework-api** | 后端API服务 (端口3000) | ✅ 在线 |
| **webhook-listener** | GitHub自动部署 (端口9000) | ✅ 在线 |

---

## 7. Nginx 配置

| 配置文件 | 用途 |
|---|---|
| `/etc/nginx/conf.d/default.conf` | 80端口代理到3000 |
| `/etc/nginx/conf.d/admin.conf` | 9090端口管理后台 |

---

## 8. 访问地址汇总

| 服务 | 地址 |
|---|---|
| **后端API** | http://39.104.58.26/api |
| **管理后台** | http://39.104.58.26:9090 |
| **Webhook** | http://39.104.58.26:9000/webhook |

---

## 9. 当前系统状态总结

| 组件 | 状态 |
|---|---|
| 服务器 | ✅ 运行正常 |
| 数据库 | ✅ 连接正常 |
| 代码仓库 | ✅ SSH克隆成功 |
| 自动部署 | ✅ Webhook运行中 |
| 后端API | ✅ 所有模块正常 |
| 管理后台 | ⏳ 部署中 |
| 小程序 | ⏸ 待配置微信AppID |

**整体状态**: ✅ **核心组件均已配置并测试通过，系统处于可运行状态。**
